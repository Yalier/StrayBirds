---
layout: post
title: GCD
category: 技术
comments: false
---

### 任务和队列

**任务**：就是执行操作的意思，换句话说就是你在线程中执行的那段代码。在GCD中是放在block中的。执行任务有两种方式：同步执行和异步执行。两者的主要区别是：是否具备开启新线程的能力。

同步执行（sync）：只能在当前线程中执行任务，不具备开启新线程的能力

异步执行（async）：可以在新的线程中执行任务，具备开启新线程的能力


**队列**：这里的队列指任务队列，即用来存放任务的队列。队列是一种特殊的线性表，采用FIFO（先进先出）的原则，即新任务总是被插入到队列的末尾，而读取任务的时候总是从队列的头部开始读取。每读取一个任务，则从队列中释放一个任务。在GCD中有两种队列：串行队列和并行队列。

并行队列（Concurrent Dispatch Queue）：可以让多个任务并行（同时）执行（自动开启多个线程同时执行任务）

并行功能只有在异步（dispatch_async）函数下才有效

串行队列（Serial Dispatch Queue）：让任务一个接着一个地执行（一个任务执行完毕后，再执行下一个任务）


### 使用

* 队列的创建
可以使用dispatch_queue_create来创建对象，需要传入两个参数，第一个参数表示队列的唯一标识符，用于DEBUG，可为空；第二个参数用来识别是串行队列还是并行队列。DISPATCH_QUEUE_SERIAL表示串行队列，DISPATCH_QUEUE_CONCURRENT表示并行队列。

// 串行队列的创建方法
dispatch_queue_t queue= dispatch_queue_create("test.queue", DISPATCH_QUEUE_SERIAL);

// 并行队列的创建方法
dispatch_queue_t queue= dispatch_queue_create("test.queue", DISPATCH_QUEUE_CONCURRENT);

* 任务的创建
// 同步执行任务创建方法

''dispatch_sync(queue, ^{

NSLog(@"%@",[NSThread currentThread]); 

});''

// 异步执行任务创建方法

''dispatch_async(queue, ^{

NSLog(@"%@",[NSThread currentThread]);

});''


* 主队列

主队列是GCD自带的一种特殊的串行队列

所有放在主队列中的任务，都会放到主线程中执行

可使用dispatch_get_main_queue()获得主队列

‘’
dispatch_queue_t queue = dispatch_get_main_queue();

//同步任务
dispatch_sync(queue, ^{

for (int i = 0; i < 2; ++i) {

NSLog(@"1------%@",[NSThread currentThread]);

}

});

//异步任务
dispatch_async(queue, ^{

for (int i = 0; i < 2; ++i) {

NSLog(@"1------%@",[NSThread currentThread]);

}

});
‘’

